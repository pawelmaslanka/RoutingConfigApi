{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "bgp-main-config",
  "type": "object",
  "$defs": {
    "community-body-select": {
      "oneOf": [
        {
          "$ref": "#/$defs/community-set-type"
        },
        {
          "type": "object",
          "properties": {
            "community-list": {
              "$ref": "#/$defs/list-name-type"
            }
          },
          "required": ["community-list"],
          "additionalProperties": false
        }
      ]
    },
    "ext-community-body-select": {
      "oneOf": [
        {
          "$ref": "#/$defs/ext-community-set-type"
        },
        {
          "type": "object",
          "properties": {
            "ext-community-list": {
              "$ref": "#/$defs/list-name-type"
            }
          },
          "required": ["ext-community-list"],
          "additionalProperties": false
        }
      ]
    },
    "if-match-body": {
      "type": "object",
      "properties": {
        "as-path-eq": {
          "$ref": "#/$defs/as-path-body-select"
        },
        "as-path-in": {
          "$ref": "#/$defs/as-path-body-select"
        },
        "as4-path-eq": {
          "$ref": "#/$defs/as4-path-body-select"
        },
        "as4-path-in": {
          "$ref": "#/$defs/as4-path-body-select"
        },
        "community-eq": {
          "$ref": "#/$defs/community-body-select"
        },
        "community-in": {
          "$ref": "#/$defs/community-body-select"
        },
        "ext-community-eq": {
          "$ref": "#/$defs/ext-community-body-select"
        },
        "ext-community-in": {
          "$ref": "#/$defs/ext-community-body-select"
        },
        "large-community-eq": {
          "$ref": "#/$defs/large-community-body-select"
        },
        "large-community-in": {
          "$ref": "#/$defs/large-community-body-select"
        },
        "match-type": {
          "type": "string",
          "enum": [
            "ALL",
            "ANY"
          ],
          "default": "ALL"
        },
        "net-eq": {
          "oneOf": [
            {
              "type": "object",
              "properties": {
                "prefix-v4": {
                  "$ref": "#/$defs/prefix-v4-type"
                }
              },
              "required": ["prefix-v4"],
              "additionalProperties": false
            },
            {
              "type": "object",
              "properties": {
                "prefix-v6": {
                  "$ref": "#/$defs/prefix-v6-type"
                }
              },
              "required": ["prefix-v6"],
              "additionalProperties": false
            }
          ]
        },
        "net-in": {
          "oneOf": [
            {
              "type": "object",
              "properties": {
                "prefix-v4": {
                  "$ref": "#/$defs/prefix-v4-type"
                }
              },
              "additionalProperties": false
            },
            {
              "type": "object",
              "properties": {
                "prefix-v6": {
                  "$ref": "#/$defs/prefix-v6-type"
                }
              },
              "additionalProperties": false
            },
            {
              "type": "object",
              "properties": {
                "prefix-v4-list": {
                  "$ref": "#/$defs/list-name-type"
                }
              },
              "additionalProperties": false
            },
            {
              "type": "object",
              "properties": {
                "prefix-v6-list": {
                  "$ref": "#/$defs/list-name-type"
                }
              },
              "additionalProperties": false
            }
          ]
        },
        "net-type-eq": {
          "$ref": "#/$defs/addr-family-type"
        },
        "source-protocol-eq": {
          "type": "string",
          "enum": [ "BGP", "STATIC" ]
        }
      },
      "additionalProperties": false
    },
    "net-body-select": {
      "oneOf": [
        {
          "type": "array",
          "items": {
              "$ref": "#/$defs/prefix-v4-type"
          },
          "required": ["prefix-v4"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "prefix-v4": {
              "$ref": "#/$defs/prefix-v4-type"
            }
          },
          "required": ["prefix-v4"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "prefix-v6": {
              "$ref": "#/$defs/prefix-v6-type"
            }
          },
          "required": ["prefix-v6"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "prefix-v4-list": {
              "$ref": "#/$defs/list-name-type"
            }
          },
          "required": ["prefix-v4-list"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "prefix-v6-list": {
              "$ref": "#/$defs/list-name-type"
            }
          },
          "required": ["prefix-v6-list"],
          "additionalProperties": false
        }
      ]
    },
    "large-community-body-select": {
      "oneOf": [
        {
          "$ref": "#/$defs/large-community-set-type"
        },
        {
          "type": "object",
          "properties": {
            "large-community-list": {
              "$ref": "#/$defs/list-name-type"
            }
          },
          "required": ["large-community-list"],
          "additionalProperties": false
        }
      ]
    }
  },
  "properties": {
    "router-id": {
      "$ref": "#/$defs/ipv4-addr-type"
    },
    "bgp": {
      "type": "object",
      "properties": {
        "as-path-list": {
          "type": "object",
          "patternProperties": {
            "^[a-zA-Z0-9_]+$": {
              "$ref": "#/$defs/as-path-type"
            }
          },
          "additionalProperties": false
        },
        "community-list": {
          "type": "object",
          "patternProperties": {
            "^[a-zA-Z0-9_]+$": {
              "$ref": "#/$defs/community-set-type"
            }
          },
          "additionalProperties": false
        },
        "ext-community-list": {
          "type": "object",
          "patternProperties": {
            "^[a-zA-Z0-9_]+$": {
              "$ref": "#/$defs/ext-community-set-type"
            }
          },
          "additionalProperties": false
        },
        "large-community-list": {
          "type": "object",
          "patternProperties": {
            "^[a-zA-Z0-9_]+$": {
              "$ref": "#/$defs/large-community-set-type"
            }
          },
          "additionalProperties": false
        },
        "policy-list": {
          "type": "object",
          "patternProperties": {
            "^[a-zA-Z0-9_]+$": {
              "type": "object",
              "patternProperties": {
                "^term-[0-9]+$": {
                  "type": "object",
                  "properties": {
                    "seq": {
                      "type": "integer",
                      "minimum": 1
                    },
                    "if-match": {
                      "$ref": "#/$defs/if-match-body"
                    },
                    "then": {
                      "$ref": "#/$defs/action-body"
                    }
                  },
                  "required": [ "if-match", "then" ],
                  "additionalProperties": false
                },
                "default-action": {
                  "type": "string",
                  "enum": [ "deny", "permit" ],
                  "default": "deny"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "prefix-v4-list": {
          "type": "object",
          "patternProperties": {
            "^[a-zA-Z0-9_]+$": {
              "$ref": "#/$defs/prefix-v4-type"
            }
          },
          "additionalProperties": false
        },
        "prefix-v6-list": {
          "type": "object",
          "patternProperties": {
            "^[a-zA-Z0-9_]+$": {
              "$ref": "#/$defs/prefix-v6-type"
            }
          },
          "additionalProperties": false
        },
        "sessions": {
          "type": "object",
          "patternProperties": {
            "^[a-zA-Z0-9_]+$": {
              "type": "object",
              "properties": {
                "address-family": {
                  "$comment": "Channels name like: ipv4, ipv6, ipv4 multicast, ipv6 multicast, ipv4 mpls, ipv6 mpls, vpn4 mpls, vpn6 mpls, vpn4 multicast, vpn6 multicast, flow4, flow6",
                  "type": "object",
                  "patternProperties": {
                    "^ipv4|ipv6$": {
                      "type": "object",
                      "properties": {
                        "next-hop-self": {
                          "type": "boolean"
                        },
                        "policy-in": {
                          "$ref": "#/$defs/list-name-type"
                        },
                        "policy-out": {
                          "$ref": "#/$defs/list-name-type"
                        }
                      },
                      "additionalProperties": false
                    }
                  },
                  "additionalProperties": false
                },
                "local": {
                  "type": "object",
                  "properties": {
                    "address": {
                      "oneOf": [
                        { "$ref": "#/$defs/ipv4-addr-type" },
                        { "$ref": "#/$defs/ipv6-addr-type" }
                      ]
                    },
                    "as": {
                      "type": "integer",
                      "minimum": 1
                    },
                    "port": {
                      "type": "integer", "minimum": 0, "maximum": 65535
                    }
                  },
                  "additionalProperties": false,
                  "required": [ "as" ]
                },
                "peer": {
                  "type": "object",
                  "properties": {
                    "address": {
                      "oneOf": [
                        { "$ref": "#/$defs/ipv4-addr-type" },
                        { "$ref": "#/$defs/ipv6-addr-type" },
                        {
                          "type": "object",
                          "properties": {
                            "range": {
                              "oneOf": [
                                { "$ref": "#/$defs/ipv4-prefix-type" },
                                { "$ref": "#/$defs/ipv6-prefix-type" }
                              ]
                            }
                          },
                          "additionalProperties": false
                        }
                      ]
                    },
                    "as": {
                      "oneOf": [
                        {
                          "type": "integer",
                          "minimum": 1
                        },
                        {
                          "type": "string",
                          "enum": [ "external", "internal" ]
                        }
                      ]
                    },
                    "link-local": {
                      "type": "object",
                      "properties": {
                        "address": {
                          "description": "Link-local IPv6 address",
                          "$ref": "#/$defs/ipv6-link-local-addr-type"
                        },
                        "interface": {
                          "description": "Linux based allowed interface name",
                          "type": "string",
                          "pattern": "^[^\\s/]{1,15}$"
                        }
                      },
                      "additionalProperties": false,
                      "required":  [ "address" ]
                    },
                    "port": {
                      "type": "integer", "minimum": 0, "maximum": 65535
                    }
                  },
                  "additionalProperties": false,
                  "oneOf": [
                    {
                      "required": [ "address", "as" ]
                    },
                    {
                      "required": [ "link-local", "as" ]
                    }
                  ]
                },
                "ebgp": {
                  "type": "object",
                  "properties": {
                    "multihop": {
                      "type": "object",
                      "properties": {
                        "ttl": {
                          "description": "TTL=1 means it is directly connected",
                          "type": "integer", "minimum": 1, "maximum": 255
                        }
                      },
                      "additionalProperties": false
                    },
                    "route-server": {
                      
                    }
                  }
                },
                "ibgp": {
                  "type": "object",
                  "properties": {
                    "route-reflector": {

                    }
                  },
                  "additionalProperties": false
                },
                "capabilities": {
                  "type": "object",
                  "properties": {
                    "4-octet-asn": {
                      "type": "boolean"
                    }
                  },
                  "additionalProperties": false
                },
                "extensions": {
                  
                }
              },
              "additionalProperties": false,
              "required": [ "address-family", "local", "peer" ],
              "not": {
                "$comment": "ebgp and ibgp property is mutually excluded and that's why disallowed to define both at the same time",
                "required": [ "ebgp", "ibgp" ]
              }
            }
          },
          "additionalProperties": false
        }
      },
      "required": [ "sessions" ],
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "required": [ "router-id" ]
}
